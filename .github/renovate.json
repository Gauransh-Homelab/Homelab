{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":dependencyDashboard",
    ":semanticCommitTypeAll(feat)"
  ],
  "automerge": false,
  "timezone": "Asia/Singapore",
  "labels": [
    "renovate",
    "dependencies"
  ],
  "assigneesFromCodeOwners": true,
  "rebaseWhen": "behind-base-branch",
  "kubernetes": {
    "managerFilePatterns": [
      "/\\.yaml$/",
      "/\\.yml$/"
    ]
  },
  "packageRules": [
    {
      "matchCategories": [
        "docker"
      ],
      "pinDigests": false
    },
    {
      "description": "Map lscr.io LinuxServer images to Docker Hub",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": ["^linuxserver/"],
      "registryUrls": ["https://index.docker.io"]
    },
    {
      "description": "Review stable container updates manually",
      "matchDatasources": [
        "docker"
      ],
      "matchUpdateTypes": [
        "minor",
        "patch",
        "digest"
      ],
      "matchPackageNames": [
        "linuxserver/sonarr",
        "linuxserver/radarr",
        "linuxserver/bazarr",
        "linuxserver/prowlarr",
        "linuxserver/qbittorrent",
        "linuxserver/nzbget",
        "jellyfin/jellyfin",
        "fallenbagel/jellyseerr",
        "golift/notifiarr",
        "gcr.io/distroless/static",
        "qmcgaw/gluetun"
      ]
    },
    {
      "description": "Review k8s infrastructure updates manually",
      "matchDatasources": [
        "docker"
      ],
      "matchUpdateTypes": [
        "minor",
        "patch"
      ],
      "matchPackageNames": [
        "registry.k8s.io/descheduler/descheduler",
        "quay.io/jetstack/cert-manager-controller",
        "quay.io/jetstack/cert-manager-webhook",
        "quay.io/jetstack/cert-manager-cainjector",
        "traefik",
        "ghcr.io/onedr0p/kubernetes-kubectl"
      ]
    },
    {
      "description": "Group ArgoCD updates",
      "matchDatasources": [
        "docker",
        "helm"
      ],
      "groupName": "ArgoCD",
      "automerge": false,
      "matchPackageNames": [
        "/argo-cd/",
        "/argocd/"
      ]
    },
    {
      "description": "Allow major updates but don't auto-merge",
      "matchDatasources": [
        "docker"
      ],
      "matchUpdateTypes": [
        "major"
      ],
      "enabled": true,
      "automerge": false
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "description": "Process lscr.io container images in Kubernetes files",
      "managerFilePatterns": [
        "/\\.yaml$/",
        "/\\.yml$/"
      ],
      "matchStrings": [
        "image:\\s+lscr\\.io/(?<depName>[^:]+):(?<currentValue>[^\\s]+)"
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker",
      "registryUrlTemplate": "https://lscr.io"
    },
    {
      "customType": "regex",
      "description": "Process other container images in Kubernetes files",
      "managerFilePatterns": [
        "/\\.yaml$/",
        "/\\.yml$/"
      ],
      "matchStrings": [
        "image:\\s+(?!lscr\\.io/)(?<depName>[^:]+):(?<currentValue>[^\\s]+)"
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker"
    }
  ],
  "ignorePresets": [
    ":prHourlyLimit2"
  ],
  "allowedCommands": [],
  "allowedVersions": "!/^.*-(alpha|beta|rc|dev|canary|unstable|preview|pre|test|experimental).*$/",
  "commitMessagePrefix": "feat({{packageFileDir}}):",
  "commitMessageTopic": "update {{depName}} to {{newVersion}}",
  "commitMessageExtra": "from {{currentVersion}}",
  "prCreation": "immediate",
  "prHourlyLimit": 10,
  "prConcurrentLimit": 20
}
